<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alo Chaya - CPM Dashboard</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        /* --- 1. Design Tokens & Root --- */
        :root {
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            
            --color-bg: #FBFAF8;       /* Off-white */
            --color-text: #111214;     /* Charcoal */
            --color-accent: #CFA76C;   /* Muted Gold */
            --color-accent-light: #fbf8f2; /* Very light gold */
            --color-surface: #FFFFFF;
            --color-border: #EFEFEF;
            --color-muted: #8E8E8E;
            --color-success: #059669;
            --color-danger: #be123c;

            --shadow-sm: 0 2px 4px rgba(0,0,0,0.02);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.05);
            --radius: 8px;
        }

        /* --- 2. Reset & Base --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-body);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* --- 3. Page Header --- */
        .page-header {
            padding: 1.5rem 1.5rem;
            background-color: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .page-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 700;
        }
        .page-title span { color: var(--color-accent); }

        .back-link {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--color-text);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background-color: var(--color-text);
            color: var(--color-surface);
        }
        
        /* --- 4. CPM Two-Panel Layout --- */
        .cpm-layout {
            display: grid;
            grid-template-columns: 375px 1fr; /* Fixed left panel, flexible right */
            height: calc(100vh - 75px); /* Full height minus header */
        }

        /* --- 5. Left Panel (Property List) --- */
        .left-panel {
            background: var(--color-surface);
            border-right: 1px solid var(--color-border);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .search-bar {
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-border);
        }
        
        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            border-radius: var(--radius);
            border: 1px solid var(--color-border);
            font-family: var(--font-body);
        }
        .search-bar input:focus {
            outline: 2px solid var(--color-accent);
            border-color: var(--color-accent);
        }
        
        .property-list {
            list-style: none;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .property-list-item button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 1.25rem 1.5rem;
            border: none;
            border-bottom: 1px solid var(--color-border);
            background: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        .property-list-item button:hover {
            background-color: var(--color-accent-light);
        }
        .property-list-item button.active {
            background-color: var(--color-accent-light);
            color: var(--color-accent);
            font-weight: 600;
            box-shadow: inset 4px 0 0 var(--color-accent);
        }
        .property-list-item button .small {
            font-size: 0.8rem;
            color: var(--color-muted);
            font-weight: 400;
        }

        /* --- 6. Right Panel (Data Display) --- */
        .right-panel {
            height: 100%;
            overflow-y: auto;
            padding: 2.5rem;
            background-color: var(--color-bg);
            /* Marble texture background */
            background-image: url('https://www.transparenttextures.com/patterns/subtle-white-feathers.png');
            background-attachment: fixed;
        }
        
        .right-panel-header h2 {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .right-panel-header p {
            font-size: 1.1rem;
            color: var(--color-muted);
            margin-bottom: 2rem;
        }

        .cpm-data-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow-md);
        }
        
        .cpm-data-card h3 {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-accent);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .cpm-data-card p {
            font-size: 0.95rem;
            line-height: 1.7;
        }

        /* --- 7. Feedback Tabs --- */
        .feedback-tabs {
            margin-top: 2.5rem;
            border-bottom: 2px solid var(--color-border);
            display: flex;
            gap: 1.5rem;
        }
        .tab-button {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.75rem 0.5rem;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--color-muted);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab-button:hover {
            color: var(--color-text);
        }
        .tab-button.active {
            color: var(--color-text);
            border-bottom-color: var(--color-accent);
        }
        
        .tab-panel {
            padding-top: 2rem;
        }
        
        /* --- 8. Aggregate Insights (KPIs) --- */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .kpi-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }
        .kpi-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-muted);
            margin-bottom: 0.5rem;
        }
        .kpi-value {
            font-family: var(--font-heading);
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--color-accent);
        }
        .kpi-list {
            list-style: none;
            padding-left: 0;
            font-size: 0.95rem;
        }
        .kpi-list li {
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .kpi-list li span {
            font-weight: 400;
            color: var(--color-muted);
        }

        /* --- 9. Visit Feedback Cards --- */
        .visit-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
        }
        .visit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .visit-title {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            font-weight: 600;
        }
        .visit-rating {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-accent);
        }
        .visit-card h4 {
            font-weight: 600;
            color: var(--color-text);
            font-size: 0.9rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        .visit-card p, .visit-card ul {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }
        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            list-style: none;
            padding: 0;
        }
        .tag {
            font-size: 0.85rem;
            padding: 0.25rem 0.75rem;
            border-radius: 99px;
            font-weight: 500;
        }
        .tag.like {
            background-color: var(--color-success);
            color: white;
        }
        .tag.dislike {
            background-color: var(--color-danger);
            color: white;
        }
        
        .no-data {
            text-align: center;
            font-style: italic;
            color: var(--color-muted);
            padding: 3rem;
        }
    </style>
</head>
<body x-data="cpmDashboard()" x-cloak>

    <header class="page-header">
        <div class="container">
            <h1 class="page-title">CPM <span>Dashboard</span></h1>
            <a href="./index.html" class="back-link">&larr; Back to Central HUD</a>
        </div>
    </header>

    <main class="cpm-layout">
    
        <aside class="left-panel">
            <div class="search-bar">
                <input type="search" x-model="searchTerm" placeholder="Search competitors...">
            </div>
            
            <ul class="property-list">
                <template x-for="property in filteredProperties" :key="property.propertyLabel">
                    <li class="property-list-item">
                        <button 
                            @click="selectedProperty = property" 
                            :class="{ 'active': selectedProperty === property }"
                        >
                            <span x-text="property.propertyLabel"></span><br>
                            <span class="small" x-text="property.cpData.priceNotes"></span>
                        </button>
                    </li>
                </template>
            </ul>
        </aside>
        
        <section class="right-panel">
            <div x-show="!selectedProperty" class="no-data">
                <p>Select a property from the left to view its details.</p>
            </div>
        
            <div x-show="selectedProperty" x-transition>
                
                <div class="right-panel-header">
                    <h2 x-text="selectedProperty.propertyLabel"></h2>
                    <p x-text="selectedProperty.cpData.differentiator"></p>
                </div>
                
                <div class="cpm-data-card">
                    <h3>Room Profile</h3>
                    <p x-text="selectedProperty.cpData.roomProfile"></p>
                    
                    <h3>Price Range</h3>
                    <p x-text="selectedProperty.cpData.priceNotes"></p>
                    
                    <h3>Key Amenities</h3>
                    <p x-text="selectedProperty.cpData.amenities"></p>
                </div>
                
                <div x-data="{ activeTab: 'insights' }">
                    <div class="feedback-tabs">
                        <button @click="activeTab = 'insights'" class="tab-button" :class="{'active': activeTab === 'insights'}">Aggregate Insights</button>
                        <button @click="activeTab = 'firstVisit'" class="tab-button" :class="{'active': activeTab === 'firstVisit'}">First Visits</button>
                        <button @click="activeTab = 'nextVisit'" class="tab-button" :class="{'active': activeTab === 'nextVisit'}">Next Visits</button>
                        <button @click="activeTab = 'all'" class="tab-button" :class="{'active': activeTab === 'all'}">All Feedback</button>
                    </div>

                    <div x-show="activeTab === 'insights'" class="tab-panel">
                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <div class="kpi-title">Average Rating</div>
                                <div class="kpi-value" x-text="avgRating"></div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-title">NPS-ish Proxy</div>
                                <div class="kpi-value" x-text="npsProxy"></div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-title">Total Visits Logged</div>
                                <div class="kpi-value" x-text="selectedProperty.visits.length"></div>
                            </div>
                        </div>
                        <div class="kpi-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="kpi-card">
                                <div class="kpi-title">Top 3 Praised</div>
                                <ul class="kpi-list">
                                    <template x-for="item in topLikes" :key="item[0]">
                                        <li><span x-text="item[0]"></span> <span x-text="`(${item[1]} mentions)`"></span></li>
                                    </template>
                                    <li x-show="topLikes.length === 0" class="no-data" style="padding: 0;">No 'likes' logged.</li>
                                </ul>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-title">Top 3 Issues</div>
                                <ul class="kpi-list">
                                    <template x-for="item in topDislikes" :key="item[0]">
                                        <li><span x-text="item[0]"></span> <span x-text="`(${item[1]} mentions)`"></span></li>
                                    </template>
                                    <li x-show="topDislikes.length === 0" class="no-data" style="padding: 0;">No 'dislikes' logged.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div x-show="activeTab === 'firstVisit'" class="tab-panel">
                        <template x-for="visit in selectedProperty.visits.filter(v => v.visitNumber === 1)" :key="visit.guestName + visit.visitDate">
                            <div class="visit-card">
                                <div class="visit-header">
                                    <div class="visit-title" x-text="visit.guestName"></div>
                                    <div class="visit-rating" x-text="`${visit.overallRating} / 5`"></div>
                                </div>
                                <h4>Overall Impression:</h4>
                                <p x-text="visit.overallImpression"></p>
                                <h4>Likes:</h4>
                                <ul class="tags-list">
                                    <template x-for="like in visit.likes" :key="like">
                                        <li class="tag like" x-text="like"></li>
                                    </template>
                                </ul>
                                <h4>Dislikes:</h4>
                                <ul class="tags-list">
                                    <template x-for="dislike in visit.dislikes" :key="dislike">
                                        <li class="tag dislike" x-text="dislike"></li>
                                    </template>
                                </ul>
                                <h4>Service Notes:</h4>
                                <p x-text="visit.serviceNotes"></p>
                            </div>
                        </template>
                        <div x-show="selectedProperty.visits.filter(v => v.visitNumber === 1).length === 0" class="no-data">
                            <p>No first visit feedback logged for this property.</p>
                        </div>
                    </div>
                    
                    <div x-show="activeTab === 'nextVisit'" class="tab-panel">
                        <template x-for="visit in selectedProperty.visits.filter(v => v.visitNumber > 1)" :key="visit.guestName + visit.visitDate">
                             <div class="visit-card">
                                <div class="visit-header">
                                    <div class="visit-title" x-text="`${visit.guestName} (Visit #${visit.visitNumber})`"></div>
                                    <div class="visit-rating" x-text="`${visit.overallRating} / 5`"></div>
                                </div>
                                <h4>Wishlist for Next Visit:</h4>
                                <p x-text="visit.wishlistNextVisit"></p>
                                <h4>Updated Suggestions:</h4>
                                <p x-text="visit.overallImpression"></p>
                            </div>
                        </template>
                        <div x-show="selectedProperty.visits.filter(v => v.visitNumber > 1).length === 0" class="no-data">
                            <p>No repeat visit feedback logged for this property.</p>
                        </div>
                    </div>
                    
                    <div x-show="activeTab === 'all'" class="tab-panel">
                         <template x-for="visit in selectedProperty.visits" :key="visit.guestName + visit.visitDate">
                            <div class="visit-card">
                                <div class="visit-header">
                                    <div class="visit-title" x-text="`${visit.guestName} (Visit #${visit.visitNumber})`"></div>
                                    <div class="visit-rating" x-text="`${visit.overallRating} / 5`"></div>
                                </div>
                                <p x-text="visit.overallImpression"></p>
                                <h4>Likes:</h4>
                                <ul class="tags-list">
                                    <template x-for="like in visit.likes" :key="like">
                                        <li class="tag like" x-text="like"></li>
                                    </template>
                                </ul>
                                <h4>Dislikes:</h4>
                                <ul class="tags-list">
                                    <template x-for="dislike in visit.dislikes" :key="dislike">
                                        <li class="tag dislike" x-text="dislike"></li>
                                    </template>
                                </ul>
                            </div>
                        </template>
                        <div x-show="selectedProperty.visits.length === 0" class="no-data">
                            <p>No feedback logged for this property.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
    </main>

<script>
    // --- 1. THE CANONICAL DATA (as requested) ---
    // This is the single source of truth, converted from your table.
    const cpmData = [
        {
          "propertyLabel": "Alo Chaya Resort — Chandpur",
          "cpData": {
            "roomProfile": "20+ rooms in main house; rooms ≈ 345–355 sq.ft; all-marble interiors; lounges 7,000 sq.ft on 2nd & 3rd floors; future cottages planned; 2 hours from Dhaka",
            "priceNotes": "mid→high tier; target ADR 15,000 BDT adjusted",
            "amenities": "Exclusive riverine site, eco-friendly setting, wellness center, events & day-packages, curated experiences; brand/doctrine driven (heritage + wellness)",
            "differentiator": "Riverine heritage / high-touch experiential positioning; story-led moat (doc & wellness)"
          },
          "visits": [
            { "guestName":"Example Guest", "visitNumber":1, "visitDate":"2025-10-12", "overallRating":5, "overallImpression":"Relaxing, staff were attentive", "likes":["Spa","Pool","Service"], "dislikes":["None"], "serviceNotes":"Front desk: Rehan was excellent", "wishlistNextVisit":"Private boat tour" },
            { "guestName":"Family B", "visitNumber":1, "visitDate":"2025-10-14", "overallRating":4, "overallImpression":"Beautiful grounds, food was a bit slow.", "likes":["Grounds","Room"], "dislikes":["Food Speed"], "serviceNotes":"", "wishlistNextVisit":"Try the wellness package" },
            { "guestName":"Example Guest", "visitNumber":2, "visitDate":"2025-11-01", "overallRating":5, "overallImpression":"The boat tour was fantastic!", "likes":["Service"], "dislikes":[], "serviceNotes":"Boat captain was very knowledgeable.", "wishlistNextVisit":"Wedding inquiry" }
          ]
        },
        {
          "propertyLabel": "Local Competitor A (big regional resort — “Sara Resort” scale)",
          "cpData": {
            "roomProfile": "~105 rooms (many room types listed in original): Premium Villa 391 & 382 sq.ft; Water Lodge 316; Raja View Tower 370; Ancient Mud House 322–418; Villa Suite 315–459; Water Front Villa 572; Presidential Villa 422; Tree House 200; House Boat 300",
            "priceNotes": "8,500 – 66,000++ BDT / night (range provided)",
            "amenities": "Two outdoor pools, water park, multiple dining outlets, children’s play area, kayaking, spa, free Wi-Fi, parking, family & event facilities",
            "differentiator": "Large scale resort; volume + variety of accommodation; broad family & leisure focus"
          },
          "visits": [
            { "guestName":"Competitor Guest 1", "visitNumber":1, "visitDate":"2025-09-15", "overallRating":4, "overallImpression":"Kids loved the water park. Very crowded.", "likes":["Water Park","Pool"], "dislikes":["Crowded","Service"], "serviceNotes":"Staff seemed overwhelmed.", "wishlistNextVisit":"" }
          ]
        },
        {
          "propertyLabel": "Local Competitor B (boutique / Purbachal style — “The Cozy Nest” type)",
          "cpData": {
            "roomProfile": "Boutique scale — room sizes not listed explicitly in CPM; positioned as small experiential property",
            "priceNotes": "Deluxe 5,900–9,900; Superior 6,900–10,900; Premier Suite 8,900–12,900; Full Villa 28,000–39,000",
            "amenities": "Outdoor pool, laundry, business corner, luggage storage, 24/7 reception, free parking",
            "differentiator": "Small-scale, budget-friendly boutique; local urban weekend market competitor"
          },
          "visits": [
            { "guestName":"Competitor Guest 2", "visitNumber":1, "visitDate":"2025-10-01", "overallRating":3, "overallImpression":"It was fine for the price. Pool was small.", "likes":["Price"], "dislikes":["Pool","Room Size"], "serviceNotes":"", "wishlistNextVisit":"" }
          ]
        },
        {
          "propertyLabel": "Regional Competitor C (secluded luxury resort — “Dusai Resort & Spa” type)",
          "cpData": {
            "roomProfile": "Secluded destination resort; villas + spa; long drive from Dhaka (7 hours mentioned)",
            "priceNotes": "16,000 – 100,000++ BDT / night (range provided)",
            "amenities": "Villas, spa, secluded luxury, event hosting",
            "differentiator": "Luxury secluded destination; high-ticket experiential stays"
          },
          "visits": [
             { "guestName":"Competitor Guest 3", "visitNumber":1, "visitDate":"2025-08-20", "overallRating":5, "overallImpression":"Truly exceptional service and privacy. Worth the drive.", "likes":["Spa","Service","Privacy"], "dislikes":["Long Drive"], "serviceNotes":"Butler was incredible.", "wishlistNextVisit":"Return for anniversary" }
          ]
        },
        {
          "propertyLabel": "Local Competitor D (country club / villa resort — “Kaalmegha style”)",
          "cpData": {
            "roomProfile": "Royal Villas / Deluxe Villas scale; limited event capacity",
            "priceNotes": "Royal Villas ~38,450 BDT/day; Deluxe Villas 22,450–24,650 BDT/day",
            "amenities": "Exclusive villas, event amenities, club facilities",
            "differentiator": "Luxury villa / event niche; local premium clientele"
          },
          "visits": []
        },
        {
          "propertyLabel": "Local Competitor E (small villa / cottage operator — “The Cottage House” type)",
          "cpData": {
            "roomProfile": "2-bedroom villa product (intimate, small scale)",
            "priceNotes": "13,000–16,000 BDT / villa",
            "amenities": "Small private villa experience",
            "differentiator": "Intimate boutique villa competitor"
          },
          "visits": []
        },
        {
          "propertyLabel": "Local Competitor F (conventional resort — “Sonargaon Royal Resort” type)",
          "cpData": {
            "roomProfile": "Conventional resort hotel product",
            "priceNotes": "From ~7,000++ BDT / night",
            "amenities": "Standard hotel amenities",
            "differentiator": "Value / accessible resort offering"
          },
          "visits": [
             { "guestName":"Competitor Guest 4", "visitNumber":1, "visitDate":"2025-10-10", "overallRating":2, "overallImpression":"Dated rooms, poor service.", "likes":["Price"], "dislikes":["Room","Service"], "serviceNotes":"", "wishlistNextVisit":"" }
          ]
        },
        {
          "propertyLabel": "Sheraton Dhaka — Gulshan 2",
          "cpData": {
            "roomProfile": "Deluxe Rooms ~400–450 sq.ft; Club Rooms ~500 sq.ft; Suites 600–700 sq.ft",
            "priceNotes": "~11,999 BDT / night (example provided in CPM)",
            "amenities": "Rooftop pool, multiple restaurants, fitness center, spa, free Wi-Fi, parking",
            "differentiator": "International brand, business + events, consistent urban luxury"
          },
          "visits": [
            { "guestName":"City Guest 1", "visitNumber":1, "visitDate":"2025-10-05", "overallRating":5, "overallImpression":"Consistent Sheraton quality. Great business lounge.", "likes":["Service","Pool","Lounge"], "dislikes":[], "serviceNotes":"", "wishlistNextVisit":"" }
          ]
        },
        {
          "propertyLabel": "The Westin Dhaka — Gulshan 1",
          "cpData": {
            "roomProfile": "Deluxe King / Executive Twin ~409 sq.ft; Junior Suite ~600 sq.ft; Executive Suite ~800 sq.ft",
            "priceNotes": "~11,999 BDT / night (pricing note from CPM)",
            "amenities": "Rooftop pool, Heavenly Bed®, dining, fitness, spa",
            "differentiator": "International brand, premium sleep/amenity positioning"
          },
          "visits": [
            { "guestName":"City Guest 2", "visitNumber":1, "visitDate":"2025-10-02", "overallRating":4, "overallImpression":"Bed was amazing, as advertised.", "likes":["Bed","Room"], "dislikes":["Lobby Crowded"], "serviceNotes":"", "wishlistNextVisit":"" }
          ]
        },
        {
          "propertyLabel": "Le Méridien Dhaka — Nikunja 2",
          "cpData": {
            "roomProfile": "Deluxe room ~345–355 sq.ft; Club King/Two Doubles ~400 sq.ft; Le Méridien Suite 700 sq.ft; Exec Suite 1000 sq.ft; 304 rooms",
            "priceNotes": "(pricing not specifically listed in CPM text)",
            "amenities": "Floor-to-ceiling windows, LED TVs, mini-bar, coffee/tea, high-speed Wi-Fi, dining; proximity to airport",
            "differentiator": "Modern, corporate & event friendly international brand"
          },
          "visits": []
        },
        {
          "propertyLabel": "Radisson Blu Dhaka",
          "cpData": {
            "roomProfile": "Room sizes not listed in CPM",
            "priceNotes": "(pricing not listed); brunch ~2,450 BDT/person noted",
            "amenities": "Multiple dining, pool, fitness, spa, Wi-Fi, parking",
            "differentiator": "International brand, city luxury positioning"
          },
          "visits": []
        }
    ];

    // --- 2. The Alpine.js Dashboard Component ---
    document.addEventListener('alpine:init', () => {
        Alpine.data('cpmDashboard', () => ({
            allData: cpmData,
            searchTerm: '',
            selectedProperty: cpmData[0], // Select Alo Chaya by default
            
            // --- Search/Filter Logic ---
            get filteredProperties() {
                if (this.searchTerm === '') {
                    return this.allData;
                }
                return this.allData.filter(prop => {
                    const label = prop.propertyLabel.toLowerCase();
                    const amenities = prop.cpData.amenities.toLowerCase();
                    const search = this.searchTerm.toLowerCase();
                    return label.includes(search) || amenities.
includes(search);
                });
            },
            
            // --- KPI Calculation Logic ---
            get visits() {
                return this.selectedProperty ? this.selectedProperty.visits : [];
            },
            
            get avgRating() {
                if (this.visits.length === 0) return 'N/A';
                const sum = this.visits.reduce((acc, v) => acc + v.overallRating, 0);
                return (sum / this.visits.length).toFixed(1);
            },
            
            get npsProxy() {
                if (this.visits.length === 0) return 'N/A';
                const promoters = this.visits.filter(v => v.overallRating >= 4).length; // Using 4-5 as proxy
                return ((promoters / this.visits.length) * 100).toFixed(0) + '%';
            },
            
            get topLikes() {
                return this._getTopItems('likes');
            },
            
            get topDislikes() {
                return this._getTopItems('dislikes');
            },
            
            // --- Helper for KPIs ---
            _getTopItems(key) {
                if (this.visits.length === 0) return [];
                const counts = this.visits
                    .flatMap(v => v[key])
                    .filter(item => item && item.toLowerCase() !== 'none') // Filter out empty/none
                    .reduce((acc, item) => {
                        acc[item] = (acc[item] || 0) + 1;
                        return acc;
                    }, {});
                
                return Object.entries(counts)
                    .sort((a, b) => b[1] - a[1]) // Sort descending
                    .slice(0, 3); // Get top 3
            }
        }));
    });
</script>

</body>
</html>
